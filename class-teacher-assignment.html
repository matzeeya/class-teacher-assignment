<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../iron-sessionstorage/iron-sessionstorage.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-ajax/iron-request.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../paper-input/paper-input.html">

<link rel="import" href="teacher-list.html">
<link rel="import" href="room-list.html">
<link rel="import" href="secure-component.html">

<link href="https://fonts.googleapis.com/css?family=Itim&amp;subset=thai" rel="stylesheet">

<dom-module id="class-teacher-assignment">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment iron-flex-factors"> 
      :host {
        @apply(--layout-vertical);
      }
      .main {
        padding-left:50px;
      }
      .border-bottom {
        font-family: 'Itim', cursive;
        font-size: 100%;
        color: #000;
        opacity: 0.75;
        height:50px;
        width: 150px;
        border-bottom-width:1px;
        border-bottom-style:solid;
        border-bottom-color: var(--divider-color);
      }
      /* ---font---- */
      .font-header {
        font-family: 'Itim', cursive;
        font-size: 120%;
        font-weight: bold;
      }
      .font-face {
        font-family: 'Itim', cursive;
        font-size: 120%;
      }
      /* ---tabs---- */
      paper-tabs {
        --paper-tabs-selection-bar-color: #F44336;
        background-color: var(--paper-grey-50);
        height: 50px;
      }
    </style>
     
    <secure-component></secure-component>
     
    <iron-sessionstorage name="userdata" value="{{userData}}">
    </iron-sessionstorage>

    <iron-sessionstorage name="token" use-raw value="{{token}}">
    </iron-sessionstorage>

    Year:{{year}}
    Semester:{{semester}}
    <room-list token="{{token}}" host-id="{{hostId}}" 
      level="{{level}}" room="{{room}}">
    </room-list>

    <teacher-list 
      token="{{token}}" 
      level="{{level}}"
      room="{{room}}"
      year="{{year}}"
      semester="{{semester}}"
      host="{{hostId}}"> 
    </teacher-list>

  </template>

  <script>
    class ClassTeacherAssignment extends Polymer.Element {
      static get is() { return 'class-teacher-assignment'; }
      static get properties() {
        return {
          hostId:{
            type:String,
            notify:true
          },
          year:{
           type:String,
          },
          semester:{
           type:String,
          },
          __findTeacher: {
            type: String,
            computed: '_findTeacher(token,userData)'
          },
          selectedClass: {
            type:Object,
            computed: '__executeSelectedClass(rooms,selectedLevel)'
          }
        };
      }

      static get observers() {
        return [
        ]
      }

      _findTeacher(token,userData) {
        if(userData.length != 1 || token == null) return;
        var teacher_id = userData[0].value.doc.profile.teacher_id;
        var self = this;
        if(teacher_id) {
          var ele = document.createElement('iron-request');
          ele.send({
            url:"https://maas.nuqlis.com:9000/api/dbs/teacher_db/"+teacher_id,
            method:"GET",
            handleAs:"json",
            headers:{
              "Authorization":"JWT "+token
            }
          }).then(function(res) {
            self.set('teacher',res.response);
          });
        }
      }
    }

    window.customElements.define(ClassTeacherAssignment.is, 
      ClassTeacherAssignment);
  </script>
</dom-module>
